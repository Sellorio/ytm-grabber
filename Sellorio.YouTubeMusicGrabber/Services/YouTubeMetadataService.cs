using System;
using System.Net.Http;
using System.Text.Json;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using Sellorio.YouTubeMusicGrabber.Helpers;
using Sellorio.YouTubeMusicGrabber.Models.YouTube;

namespace Sellorio.YouTubeMusicGrabber.Services;

internal partial class YouTubeMetadataService(HttpClient httpClient, IYouTubeApiService youTubeApiService) : IYouTubeMetadataService
{
    public async Task<string> GetLatestYouTubeIdAsync(string youTubeId)
    {
        for (var i = 0; i < 5; i++)
        {
            var response = await httpClient.GetAsync("https://music.youtube.com/watch?v=" + youTubeId);
            response.EnsureSuccessStatusCode();
            var responseText = await response.Content.ReadAsStringAsync();
            var videoId = Regex.Match(responseText, @$"\\""videoId\\"":\\""({Constants.YouTubeIdRegex})\\""").Groups[1].Value;

            if (!string.IsNullOrEmpty(videoId))
            {
                return videoId;
            }

            await Task.Delay(1000);
        }

        throw new InvalidOperationException("Failed to retrieve latest video id due to an unknown issue.");
    }

    public async Task<YouTubeTrackMetadata> GetEnrichedTrackMetadataAsync(string youTubeId)
    {
        var metadata = await youTubeApiService.GetTrackMetadataAsync(youTubeId);

        var nextApiData = await GetDataFromNextApiAsync(youTubeId);

        var trackPlayerPanelElement =
            nextApiData.RootElement
                .GetProperty("contents")
                .GetProperty("singleColumnMusicWatchNextResultsRenderer")
                .GetProperty("tabbedRenderer")
                .GetProperty("watchNextTabbedResultsRenderer")
                .GetProperty("tabs")[0]
                .GetProperty("tabRenderer")
                .GetProperty("content")
                .GetProperty("musicQueueRenderer")
                .GetProperty("content")
                .GetProperty("playlistPanelRenderer")
                .GetProperty("contents")[0]
                .GetProperty("playlistPanelVideoRenderer");

        var trackTitle =
            trackPlayerPanelElement
                .GetProperty("title")
                .GetProperty("runs")[0]
                .GetProperty("text")
                .GetString();

        var titleSeparators = Regex.Matches(trackTitle, @" \- ");

        // For titles with translations baked in, split them up
        //   e.g. "未来キュレーション - Mirai Curation"
        // This appears to be the only option for getting the original, untranslated title
        if (titleSeparators.Count == 1)
        {
            var title1 = trackTitle.Substring(0, titleSeparators[0].Index);
            var title2 = trackTitle.Substring(titleSeparators[0].Index + 3);

            if (title1 == metadata.Title || title1 == metadata.AlternateTitle)
            {
                metadata.Title = title1;
                metadata.AlternateTitle = title2;
            }
        }

        var byLineSections =
            trackPlayerPanelElement
                .GetProperty("longBylineText")
                .GetProperty("runs");

        var albumSection = byLineSections[byLineSections.GetArrayLength() - 3];

        var albumName = albumSection.GetProperty("text").GetString();

        var albumBrowseId =
            albumSection
                .GetProperty("navigationEndpoint")
                .GetProperty("browseEndpoint")
                .GetProperty("browseId")
                .GetString();

        metadata.Album = albumName;
        metadata.AlbumId = await GetAlbumIdAsync(albumBrowseId);

        return metadata;
    }

    private async Task<JsonDocument> GetDataFromNextApiAsync(string youTubeId)
    {
        var response =
            await httpClient.PostAsync(
                "https://music.youtube.com/youtubei/v1/next?prettyPrint=false",
                new StringContent($"{{\"enablePersistentPlaylistPanel\":true,\"tunerSettingValue\":\"AUTOMIX_SETTING_NORMAL\",\"videoId\":\"{youTubeId}\",\"params\":\"8gEAmgMDCNgE\",\"playerParams\":\"igMDCNgE\",\"isAudioOnly\":true,\"responsiveSignals\":{{\"videoInteraction\":[]}},\"queueContextParams\":\"\",\"context\":{{\"client\":{{\"hl\":\"en\",\"gl\":\"AU\",\"remoteHost\":\"180.87.29.100\",\"deviceMake\":\"\",\"deviceModel\":\"\",\"visitorData\":\"CgthWGljNm5RbzAyVSihjerEBjIKCgJBVRIEGgAgMA%3D%3D\",\"userAgent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0,gzip(gfe)\",\"clientName\":\"WEB_REMIX\",\"clientVersion\":\"1.20250805.07.00\",\"osName\":\"Windows\",\"osVersion\":\"10.0\",\"originalUrl\":\"https://music.youtube.com/watch?v=LySs40nMSn4\",\"platform\":\"DESKTOP\",\"clientFormFactor\":\"UNKNOWN_FORM_FACTOR\",\"configInfo\":{{\"appInstallData\":\"CKGN6sQGEOnczxwQ8NTPHBDM364FELfq_hIQ4riwBRC9tq4FELCGzxwQ8MzPHBCYuc8cEPGcsAUQxcPPHBD8ss4cEKqdzxwQ3rzOHBDiys8cEPqrzxwQ_dvPHBCmoYATEO7VzxwQlP6wBRCZmLEFEPWegBMQvdDPHBCKgoATENr3zhwQrtbPHBCZjbEFEL2ZsAUQudnOHBDT4a8FEIiHsAUQ5snPHBCHrM4cEMbLzxwQgc3OHBC85rAFEMn3rwUQvYqwBRC45M4cEPDizhwQndCwBRDOrM8cELvZzhwQibDOHBCY8s4cEParsAUQjODPHBCRrM8cKixDQU1TSFJVZW9MMndETkhrQnNlVUVxTEE2Z3ZmeFFDcXlBVXlvS3dFQXgwSDAA\",\"coldConfigData\":null,\"coldHashData\":null,\"hotHashData\":null}},\"userInterfaceTheme\":\"USER_INTERFACE_THEME_DARK\",\"timeZone\":\"Australia/Sydney\",\"browserName\":\"Firefox\",\"browserVersion\":\"141.0\",\"acceptHeader\":\"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\",\"deviceExperimentId\":\"ChxOelV6TnpRNE5EazFNelk0TkRFd056YzNNZz09EKGN6sQGGKGN6sQG\",\"rolloutToken\":\"CKGIwP-8-uDz0gEQlrOq2amGjAMYneSa6faDjwM%3D\",\"screenWidthPoints\":1920,\"screenHeightPoints\":1067,\"screenPixelDensity\":1,\"screenDensityFloat\":1,\"utcOffsetMinutes\":600,\"musicAppInfo\":{{\"webDisplayMode\":\"WEB_DISPLAY_MODE_BROWSER\",\"storeDigitalGoodsApiSupportStatus\":{{\"playStoreDigitalGoodsApiSupportStatus\":\"DIGITAL_GOODS_API_SUPPORT_STATUS_UNSUPPORTED\"}}}}}},\"user\":{{\"lockedSafetyMode\":false}},\"request\":{{\"useSsl\":true,\"internalExperimentFlags\":[],\"consistencyTokenJars\":[]}},\"clickTracking\":{{\"clickTrackingParams\":\"IhMIxuyyhv6DjwMVVJ7YBR1oHxNGMghleHRlcm5hbA==\"}},\"adSignalsInfo\":{{\"params\":[{{\"key\":\"dt\",\"value\":\"1754957473842\"}},{{\"key\":\"flash\",\"value\":\"0\"}},{{\"key\":\"frm\",\"value\":\"0\"}},{{\"key\":\"u_tz\",\"value\":\"600\"}},{{\"key\":\"u_his\",\"value\":\"2\"}},{{\"key\":\"u_h\",\"value\":\"1200\"}},{{\"key\":\"u_w\",\"value\":\"1920\"}},{{\"key\":\"u_ah\",\"value\":\"1152\"}},{{\"key\":\"u_aw\",\"value\":\"1920\"}},{{\"key\":\"u_cd\",\"value\":\"24\"}},{{\"key\":\"bc\",\"value\":\"31\"}},{{\"key\":\"bih\",\"value\":\"1067\"}},{{\"key\":\"biw\",\"value\":\"1920\"}},{{\"key\":\"brdim\",\"value\":\"-8,-8,-8,-8,1920,0,1936,1168,1920,1067\"}},{{\"key\":\"vis\",\"value\":\"1\"}},{{\"key\":\"wgl\",\"value\":\"true\"}},{{\"key\":\"ca_type\",\"value\":\"image\"}}]}}}}}}"));

        if (!response.IsSuccessStatusCode)
        {
            var responseBody = await response.Content.ReadAsStringAsync();
            throw new InvalidOperationException("Failed to get playlist id.\r\n" + responseBody);
        }

        // Body: {"enablePersistentPlaylistPanel":true,"tunerSettingValue":"AUTOMIX_SETTING_NORMAL","videoId":"LySs40nMSn4","params":"8gEAmgMDCNgE","playerParams":"igMDCNgE","isAudioOnly":true,"responsiveSignals":{"videoInteraction":[]},"queueContextParams":"","context":{"client":{"hl":"en","gl":"AU","remoteHost":"180.87.29.100","deviceMake":"","deviceModel":"","visitorData":"CgthWGljNm5RbzAyVSihjerEBjIKCgJBVRIEGgAgMA%3D%3D","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0,gzip(gfe)","clientName":"WEB_REMIX","clientVersion":"1.20250805.07.00","osName":"Windows","osVersion":"10.0","originalUrl":"https://music.youtube.com/watch?v=LySs40nMSn4","platform":"DESKTOP","clientFormFactor":"UNKNOWN_FORM_FACTOR","configInfo":{"appInstallData":"CKGN6sQGEOnczxwQ8NTPHBDM364FELfq_hIQ4riwBRC9tq4FELCGzxwQ8MzPHBCYuc8cEPGcsAUQxcPPHBD8ss4cEKqdzxwQ3rzOHBDiys8cEPqrzxwQ_dvPHBCmoYATEO7VzxwQlP6wBRCZmLEFEPWegBMQvdDPHBCKgoATENr3zhwQrtbPHBCZjbEFEL2ZsAUQudnOHBDT4a8FEIiHsAUQ5snPHBCHrM4cEMbLzxwQgc3OHBC85rAFEMn3rwUQvYqwBRC45M4cEPDizhwQndCwBRDOrM8cELvZzhwQibDOHBCY8s4cEParsAUQjODPHBCRrM8cKixDQU1TSFJVZW9MMndETkhrQnNlVUVxTEE2Z3ZmeFFDcXlBVXlvS3dFQXgwSDAA","coldConfigData":null,"coldHashData":null,"hotHashData":null},"userInterfaceTheme":"USER_INTERFACE_THEME_DARK","timeZone":"Australia/Sydney","browserName":"Firefox","browserVersion":"141.0","acceptHeader":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","deviceExperimentId":"ChxOelV6TnpRNE5EazFNelk0TkRFd056YzNNZz09EKGN6sQGGKGN6sQG","rolloutToken":"CKGIwP-8-uDz0gEQlrOq2amGjAMYneSa6faDjwM%3D","screenWidthPoints":1920,"screenHeightPoints":1067,"screenPixelDensity":1,"screenDensityFloat":1,"utcOffsetMinutes":600,"musicAppInfo":{"webDisplayMode":"WEB_DISPLAY_MODE_BROWSER","storeDigitalGoodsApiSupportStatus":{"playStoreDigitalGoodsApiSupportStatus":"DIGITAL_GOODS_API_SUPPORT_STATUS_UNSUPPORTED"}}},"user":{"lockedSafetyMode":false},"request":{"useSsl":true,"internalExperimentFlags":[],"consistencyTokenJars":[]},"clickTracking":{"clickTrackingParams":"IhMIxuyyhv6DjwMVVJ7YBR1oHxNGMghleHRlcm5hbA=="},"adSignalsInfo":{"params":[{"key":"dt","value":"1754957473842"},{"key":"flash","value":"0"},{"key":"frm","value":"0"},{"key":"u_tz","value":"600"},{"key":"u_his","value":"2"},{"key":"u_h","value":"1200"},{"key":"u_w","value":"1920"},{"key":"u_ah","value":"1152"},{"key":"u_aw","value":"1920"},{"key":"u_cd","value":"24"},{"key":"bc","value":"31"},{"key":"bih","value":"1067"},{"key":"biw","value":"1920"},{"key":"brdim","value":"-8,-8,-8,-8,1920,0,1936,1168,1920,1067"},{"key":"vis","value":"1"},{"key":"wgl","value":"true"},{"key":"ca_type","value":"image"}]}}}
        // Response: {"responseContext":{"serviceTrackingParams":[{"service":"CSI","params":[{"key":"c","value":"WEB_REMIX"},{"key":"cver","value":"1.20250805.07.00"},{"key":"yt_li","value":"1"},{"key":"GetWatchNext_rid","value":"0x7fca1b28414b8ba1"}]},{"service":"GFEEDBACK","params":[{"key":"logged_in","value":"1"},{"key":"e","value":"23804281,24004644,24077241,24290153,24407444,24425063,24499534,39328892,51010235,51037346,51037349,51063643,51065188,51089007,51098299,51115184,51125020,51152050,51176421,51178316,51178333,51178342,51178355,51183910,51191448,51204329,51222973,51227037,51237842,51242448,51311031,51311034,51313109,51313765,51313767,51340662,51341228,51342857,51349914,51353393,51354567,51357475,51362038,51362073,51366423,51367489,51372971,51375205,51386500,51386540,51389629,51404237,51404808,51404810,51404953,51411777,51413179,51414983,51425030,51432560,51433499,51440725,51440854,51441712,51445004,51447191,51448334,51448401,51452481,51452493,51456421,51456628,51457459,51459425,51463387,51463532,51466924,51467525,51471783,51473812,51475686,51477494,51478690,51478867,51483631,51484222,51487680,51488085,51489567,51490158,51490267,51490331,51491127,51491753,51492546,51492990,51494655,51495296,51498459,51499795,51500051,51505436,51506324,51506441,51506681,51506999,51508651,51509315,51509613,51510319,51510485,51510817,51511952,51518808,51518821,51521045,51521954,51522681,51524403,51526700,51528608,51529398,51529759,51530495,51530538,51532253,51533382,51533393,51533400,51533405,51533566,51533801,51534326,51534331,51534340,51534347,51534354,51534669,51535728,51536437,51538053,51538888,51539213,51539472,51540719,51541345,51542227,51542673,51544153,51544588,51544597,51545646,51545849,51546092,51546375,51546508,51546675,51546708,51546981,51547388,51547834,51548066,51548755,51549124,51549275,51549695,51550011,51550139,51550966,51552455,51552471,51552476,51554456,51556198,51556895,51557394,51557753,51560265,51561311,51561620,51561685,51561935,51562255,51565116,51565681,51566073,51566346,51566436,51567395,51567773,51568224,51572506,51573057,100670017"}]},{"service":"ECATCHER","params":[{"key":"client.version","value":"1.20000101"},{"key":"client.name","value":"WEB_REMIX"}]}],"innertubeTokenJar":{"appTokens":[{"type":2,"value":"EicKI1FQeUJHQ3Nwa1pXaDBJWlBTY1p4UGZDU0lDYzNkUjZfMzIxEAA=","maxAgeSeconds":86400,"creationTimeUsec":"1754957474206014"}]}},"contents":{"singleColumnMusicWatchNextResultsRenderer":{"tabbedRenderer":{"watchNextTabbedResultsRenderer":{"tabs":[{"tabRenderer":{"title":"Up next","content":{"musicQueueRenderer":{"content":{"playlistPanelRenderer":{"contents":[{"playlistPanelVideoRenderer":{"title":{"runs":[{"text":"Truth."}]},"longBylineText":{"runs":[{"text":"TrySail","navigationEndpoint":{"clickTrackingParams":"CBgQyCAYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","browseEndpoint":{"browseId":"UCAlgARWIbwpbOLr9zhTUAjQ","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_ARTIST"}}}}},{"text":" • "},{"text":"Truth.","navigationEndpoint":{"clickTrackingParams":"CBgQyCAYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","browseEndpoint":{"browseId":"MPREb_FmVC7vcsk5c","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_ALBUM"}}}}},{"text":" • "},{"text":"2018"}]},"thumbnail":{"thumbnails":[{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w60-h60-l90-rj","width":60,"height":60},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w120-h120-l90-rj","width":120,"height":120},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w180-h180-l90-rj","width":180,"height":180},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w226-h226-l90-rj","width":226,"height":226},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w302-h302-l90-rj","width":302,"height":302},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w544-h544-l90-rj","width":544,"height":544}]},"lengthText":{"runs":[{"text":"4:14"}],"accessibility":{"accessibilityData":{"label":"4 minutes, 14 seconds"}}},"selected":true,"navigationEndpoint":{"clickTrackingParams":"CBgQyCAYACITCIvq4Yb-g48DFb10nQkdoAsI_TIDQkZhSP6Usc60nKuSL5oBBQgMEPgd","watchEndpoint":{"videoId":"LySs40nMSn4","params":"OAHyAQIIAZIEI1FQeUJHQ3Nwa1pXaDBJWlBTY1p4UGZDU0lDYzNkUjZfMzIx6gQLTHlTczQwbk1TbjQ%3D","playerParams":"igYjUVB5QkdDc3BrWldoMElaUFNjWnhQZkNTSUNjM2RSNl8zMjE%3D","watchEndpointMusicSupportedConfigs":{"watchEndpointMusicConfig":{"hasPersistentPlaylistPanel":true,"musicVideoType":"MUSIC_VIDEO_TYPE_ATV"}}}},"videoId":"LySs40nMSn4","shortBylineText":{"runs":[{"text":"TrySail"}]},"trackingParams":"CBgQyCAYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","menu":{"menuRenderer":{"items":[{"menuNavigationItemRenderer":{"text":{"runs":[{"text":"Start radio"}]},"icon":{"iconType":"MIX"},"navigationEndpoint":{"clickTrackingParams":"CCoQm_MFGAAiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchEndpoint":{"videoId":"LySs40nMSn4","playlistId":"RDAMVMLySs40nMSn4","params":"wAEB","loggingContext":{"vssLoggingContext":{"serializedContextData":"GhFSREFNVk1MeVNzNDBuTVNuNA%3D%3D"}},"watchEndpointMusicSupportedConfigs":{"watchEndpointMusicConfig":{"musicVideoType":"MUSIC_VIDEO_TYPE_ATV"}}}},"trackingParams":"CCoQm_MFGAAiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuServiceItemRenderer":{"text":{"runs":[{"text":"Play next"}]},"icon":{"iconType":"QUEUE_PLAY_NEXT"},"serviceEndpoint":{"clickTrackingParams":"CCgQvu4FGAEiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","queueAddEndpoint":{"queueTarget":{"videoId":"LySs40nMSn4","onEmptyQueue":{"clickTrackingParams":"CCgQvu4FGAEiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchEndpoint":{"videoId":"LySs40nMSn4"}},"backingQueuePlaylistId":"QPyBGCspkZWh0IZPScZxPfCSICc3dR6_321"},"queueInsertPosition":"INSERT_AFTER_CURRENT_VIDEO","commands":[{"clickTrackingParams":"CCgQvu4FGAEiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","addToToastAction":{"item":{"notificationTextRenderer":{"successResponseText":{"runs":[{"text":"Song will play next"}]},"trackingParams":"CCkQyscDIhMIi-rhhv6DjwMVvXSdCR2gCwj9"}}}}]}},"trackingParams":"CCgQvu4FGAEiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuServiceItemRenderer":{"text":{"runs":[{"text":"Add to queue"}]},"icon":{"iconType":"ADD_TO_REMOTE_QUEUE"},"serviceEndpoint":{"clickTrackingParams":"CCYQ--8FGAIiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","queueAddEndpoint":{"queueTarget":{"videoId":"LySs40nMSn4","onEmptyQueue":{"clickTrackingParams":"CCYQ--8FGAIiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchEndpoint":{"videoId":"LySs40nMSn4"}},"backingQueuePlaylistId":"QPyBGCspkZWh0IZPScZxPfCSICc3dR6_321"},"queueInsertPosition":"INSERT_AT_END","commands":[{"clickTrackingParams":"CCYQ--8FGAIiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","addToToastAction":{"item":{"notificationTextRenderer":{"successResponseText":{"runs":[{"text":"Song added to queue"}]},"trackingParams":"CCcQyscDIhMIi-rhhv6DjwMVvXSdCR2gCwj9"}}}}]}},"trackingParams":"CCYQ--8FGAIiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"toggleMenuServiceItemRenderer":{"defaultText":{"runs":[{"text":"Save to library"}]},"defaultIcon":{"iconType":"LIBRARY_ADD"},"defaultServiceEndpoint":{"clickTrackingParams":"CCUQhP8FGAMiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","feedbackEndpoint":{"feedbackToken":"AB9zfpJuGtS2K1rqT-IamN9QsNSH1jl2njTZX-UdyZvnamnHLvvxojB2RfDOnK-W0vFdsF2P9SFDKOdTNiW-J9vlV9EJ9KNrOQ"}},"toggledText":{"runs":[{"text":"Remove from library"}]},"toggledIcon":{"iconType":"LIBRARY_SAVED"},"toggledServiceEndpoint":{"clickTrackingParams":"CCUQhP8FGAMiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","feedbackEndpoint":{"feedbackToken":"AB9zfpL6BSUJcWrMVynfSGTdhASEuqcHiByx_f7A3dj7yN7gAUV7AZev7tJyuBdBco1dtf9Qt1E-u-FUMQe9ddyI-0-VzGWysA"}},"trackingParams":"CCUQhP8FGAMiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"toggleMenuServiceItemRenderer":{"defaultText":{"runs":[{"text":"Add to liked songs"}]},"defaultIcon":{"iconType":"FAVORITE"},"defaultServiceEndpoint":{"clickTrackingParams":"CCQQjJ8GGAQiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","likeEndpoint":{"status":"LIKE","target":{"videoId":"LySs40nMSn4"},"actions":[{"clickTrackingParams":"CCQQjJ8GGAQiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","musicLibraryStatusUpdateCommand":{"libraryStatus":"MUSIC_LIBRARY_STATUS_IN_LIBRARY","addToLibraryFeedbackToken":"AB9zfpJuGtS2K1rqT-IamN9QsNSH1jl2njTZX-UdyZvnamnHLvvxojB2RfDOnK-W0vFdsF2P9SFDKOdTNiW-J9vlV9EJ9KNrOQ"}}],"likeParams":"OAI%3D"}},"toggledText":{"runs":[{"text":"Remove from liked songs"}]},"toggledIcon":{"iconType":"UNFAVORITE"},"toggledServiceEndpoint":{"clickTrackingParams":"CCQQjJ8GGAQiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","likeEndpoint":{"status":"INDIFFERENT","target":{"videoId":"LySs40nMSn4"},"removeLikeParams":"OAI%3D"}},"trackingParams":"CCQQjJ8GGAQiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuServiceItemDownloadRenderer":{"serviceEndpoint":{"clickTrackingParams":"CCMQ0aoFGAUiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","offlineVideoEndpoint":{"videoId":"LySs40nMSn4","onAddCommand":{"clickTrackingParams":"CCMQ0aoFGAUiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","getDownloadActionCommand":{"videoId":"LySs40nMSn4","params":"CAI%3D"}}}},"trackingParams":"CCMQ0aoFGAUiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuNavigationItemRenderer":{"text":{"runs":[{"text":"Save to playlist"}]},"icon":{"iconType":"ADD_TO_PLAYLIST"},"navigationEndpoint":{"clickTrackingParams":"CCIQw5QGGAYiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","addToPlaylistEndpoint":{"videoId":"LySs40nMSn4"}},"trackingParams":"CCIQw5QGGAYiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuServiceItemRenderer":{"text":{"runs":[{"text":"Remove from queue"}]},"icon":{"iconType":"REMOVE"},"serviceEndpoint":{"clickTrackingParams":"CCAQ4_sFGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","removeFromQueueEndpoint":{"videoId":"LySs40nMSn4","commands":[{"clickTrackingParams":"CCAQ4_sFGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","addToToastAction":{"item":{"notificationTextRenderer":{"successResponseText":{"runs":[{"text":"Item removed from queue"}]},"trackingParams":"CCEQyscDIhMIi-rhhv6DjwMVvXSdCR2gCwj9"}}}}]}},"trackingParams":"CCAQ4_sFGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuNavigationItemRenderer":{"text":{"runs":[{"text":"Go to album"}]},"icon":{"iconType":"ALBUM"},"navigationEndpoint":{"clickTrackingParams":"CB8Qj_sFGAgiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","browseEndpoint":{"browseId":"MPREb_FmVC7vcsk5c","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_ALBUM"}}}},"trackingParams":"CB8Qj_sFGAgiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuNavigationItemRenderer":{"text":{"runs":[{"text":"Go to artist"}]},"icon":{"iconType":"ARTIST"},"navigationEndpoint":{"clickTrackingParams":"CB4QkPsFGAkiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","browseEndpoint":{"browseId":"UCAlgARWIbwpbOLr9zhTUAjQ","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_ARTIST"}}}},"trackingParams":"CB4QkPsFGAkiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuNavigationItemRenderer":{"text":{"runs":[{"text":"View song credits"}]},"icon":{"iconType":"PEOPLE_GROUP"},"navigationEndpoint":{"clickTrackingParams":"CB0Qr6MKGAoiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","browseEndpoint":{"browseId":"MPTCLySs40nMSn4","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_TRACK_CREDITS"}}}},"trackingParams":"CB0Qr6MKGAoiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuNavigationItemRenderer":{"text":{"runs":[{"text":"Share"}]},"icon":{"iconType":"SHARE"},"navigationEndpoint":{"clickTrackingParams":"CBwQkfsFGAsiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","shareEntityEndpoint":{"serializedShareEntity":"CgtMeVNzNDBuTVNuNA%3D%3D","sharePanelType":"SHARE_PANEL_TYPE_UNIFIED_SHARE_PANEL"}},"trackingParams":"CBwQkfsFGAsiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuServiceItemRenderer":{"text":{"runs":[{"text":"Report"}]},"icon":{"iconType":"FLAG"},"serviceEndpoint":{"clickTrackingParams":"CBsQjfYJGAwiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","getReportFormEndpoint":{"params":"EgtMeVNzNDBuTVNuNEABWAB4BQ%3D%3D"}},"trackingParams":"CBsQjfYJGAwiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"toggleMenuServiceItemRenderer":{"defaultText":{"runs":[{"text":"Pin to Listen again"}]},"defaultIcon":{"iconType":"KEEP"},"defaultServiceEndpoint":{"clickTrackingParams":"CBoQ_t4KGA0iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","feedbackEndpoint":{"feedbackToken":"AB9zfpLCPcgCnDh_olmO9yF2vjGLs0Cfmc8uDrcxiMsU-WZuwXnQOEEMaoIRa5v-YOBdhGeIsN4dhNmTKWSBE968AiH-dIfoa171EwQeIA4Jf7y3dALfHNs"}},"toggledText":{"runs":[{"text":"Unpin from Listen again"}]},"toggledIcon":{"iconType":"KEEP_OFF"},"toggledServiceEndpoint":{"clickTrackingParams":"CBoQ_t4KGA0iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","feedbackEndpoint":{"feedbackToken":"AB9zfpKB0bZpZ4ddzjPKIQi_wtEg_sPlOOWSTsk3Ih6v5TTJ-LiQ3u_MNhhTRocCrd9GARq7gSqD9ae5WIpMqCh2zQZ4O7rmQJ6_Pi2Yy0FrEDDHt1nm3CM"}},"trackingParams":"CBoQ_t4KGA0iEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"menuServiceItemRenderer":{"text":{"runs":[{"text":"Dismiss queue"}]},"icon":{"iconType":"DISMISS_QUEUE"},"serviceEndpoint":{"clickTrackingParams":"CBkQ3bwNGA4iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","deletePlaylistEndpoint":{"playlistId":"QPyBGCspkZWh0IZPScZxPfCSICc3dR6_321","command":{"clickTrackingParams":"CBkQ3bwNGA4iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","dismissQueueCommand":{}}}},"trackingParams":"CBkQ3bwNGA4iEwiL6uGG_oOPAxW9dJ0JHaALCP0="}}],"trackingParams":"CBgQyCAYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","accessibility":{"accessibilityData":{"label":"Action menu"}}}},"canReorder":true,"playlistEditParams":"SiNRUHlCR0NzcGtaV2gwSVpQU2NaeFBmQ1NJQ2MzZFI2XzMyMQ%3D%3D","queueNavigationEndpoint":{"clickTrackingParams":"CBgQyCAYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","queueAddEndpoint":{"queueTarget":{"videoId":"LySs40nMSn4","backingQueuePlaylistId":"QPyBGCspkZWh0IZPScZxPfCSICc3dR6_321"},"queueInsertPosition":"INSERT_AT_END"}}}},{"automixPreviewVideoRenderer":{"content":{"automixPlaylistVideoRenderer":{"navigationEndpoint":{"clickTrackingParams":"CBcQ_20iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchPlaylistEndpoint":{"playlistId":"RDAMVMLySs40nMSn4","params":"wAEB8gECeAGSBCNRUHlCR0NzcGtaV2gwSVpQU2NaeFBmQ1NJQ2MzZFI2XzMyMeoEC0x5U3M0MG5NU240"}},"trackingParams":"CBcQ_20iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","automixMode":"AUTOMIX_MODE_DEFAULT_ON"}}}}],"isInfinite":false,"trackingParams":"CBUQxyAiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","shuffleToggleButton":{"toggleButtonRenderer":{"defaultIcon":{"iconType":"MUSIC_SHUFFLE"},"defaultServiceEndpoint":{"clickTrackingParams":"CBYQmE0iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchEndpoint":{"playlistId":"QPyBGCspkZWh0IZPScZxPfCSICc3dR6_321","params":"wAEB8gECKAGSBCNRUHlCR0NzcGtaV2gwSVpQU2NaeFBmQ1NJQ2MzZFI2XzMyMQ%3D%3D","playerParams":"igYjUVB5QkdDc3BrWldoMElaUFNjWnhQZkNTSUNjM2RSNl8zMjE%3D","loggingContext":{"vssLoggingContext":{"serializedContextData":"GiNRUHlCR0NzcGtaV2gwSVpQU2NaeFBmQ1NJQ2MzZFI2XzMyMQ%3D%3D"}}}},"toggledIcon":{"iconType":"MUSIC_SHUFFLE"},"toggledServiceEndpoint":{"clickTrackingParams":"CBYQmE0iEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchEndpoint":{"playlistId":"QPyBGCspkZWh0IZPScZxPfCSICc3dR6_321","params":"wAEBkgQjUVB5QkdDc3BrWldoMElaUFNjWnhQZkNTSUNjM2RSNl8zMjE%3D","playerParams":"igYjUVB5QkdDc3BrWldoMElaUFNjWnhQZkNTSUNjM2RSNl8zMjE%3D","loggingContext":{"vssLoggingContext":{"serializedContextData":"GiNRUHlCR0NzcGtaV2gwSVpQU2NaeFBmQ1NJQ2MzZFI2XzMyMQ%3D%3D"}}}},"trackingParams":"CBYQmE0iEwiL6uGG_oOPAxW9dJ0JHaALCP0="}}}},"hack":true,"header":{"musicQueueHeaderRenderer":{"title":{"runs":[{"text":"Playing from"}]},"subtitle":{"runs":[{"text":"Truth. Radio"}]},"buttons":[{"chipCloudChipRenderer":{"style":{"styleType":"STYLE_TRANSPARENT"},"text":{"runs":[{"text":"Save"}]},"navigationEndpoint":{"clickTrackingParams":"CBQQ0-cHGAAiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","saveQueueToPlaylistCommand":{}},"trackingParams":"CBQQ0-cHGAAiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","icon":{"iconType":"ADD_TO_PLAYLIST"},"accessibilityData":{"accessibilityData":{"label":"Save"}},"isSelected":false,"uniqueId":"Save"}}],"trackingParams":"CBMQ0ecHIhMIi-rhhv6DjwMVvXSdCR2gCwj9"}}}},"trackingParams":"CBIQn7QFGAYiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"tabRenderer":{"endpoint":{"clickTrackingParams":"CBEQpLQFGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","browseEndpoint":{"browseId":"MPLYt_FmVC7vcsk5c-1","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_TRACK_LYRICS"}}}},"title":"Lyrics","trackingParams":"CBEQpLQFGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},{"tabRenderer":{"endpoint":{"clickTrackingParams":"CBAQlM0FGAgiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","browseEndpoint":{"browseId":"MPTRt_FmVC7vcsk5c-1","browseEndpointContextSupportedConfigs":{"browseEndpointContextMusicConfig":{"pageType":"MUSIC_PAGE_TYPE_TRACK_RELATED"}}}},"title":"Related","trackingParams":"CBAQlM0FGAgiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}}]}}}},"currentVideoEndpoint":{"clickTrackingParams":"CAAQg2ciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","watchEndpoint":{"videoId":"LySs40nMSn4","ustreamerConfig":"GgIIAg=="}},"trackingParams":"CAAQg2ciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","playerOverlays":{"playerOverlayRenderer":{"actions":[{"likeButtonRenderer":{"target":{"videoId":"LySs40nMSn4"},"likeStatus":"INDIFFERENT","trackingParams":"CA8QpUEYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","likesAllowed":true,"serviceEndpoints":[{"clickTrackingParams":"CA8QpUEYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","likeEndpoint":{"status":"LIKE","target":{"videoId":"LySs40nMSn4"},"actions":[{"clickTrackingParams":"CA8QpUEYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","musicLibraryStatusUpdateCommand":{"libraryStatus":"MUSIC_LIBRARY_STATUS_IN_LIBRARY","addToLibraryFeedbackToken":"AB9zfpK7xZnWBkrZ2w6NRsnYlfVPfbIqmtaCCuPYWlzeVZdy4vVQG3ompU6TsYBAOMAIrYKGYi6xPMeOGk40Lo_ffdwhFiCfnw"}}],"likeParams":"OAI%3D"}},{"clickTrackingParams":"CA8QpUEYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","likeEndpoint":{"status":"DISLIKE","target":{"videoId":"LySs40nMSn4"},"dislikeParams":"OAI%3D"}},{"clickTrackingParams":"CA8QpUEYACITCIvq4Yb-g48DFb10nQkdoAsI_Q==","likeEndpoint":{"status":"INDIFFERENT","target":{"videoId":"LySs40nMSn4"},"removeLikeParams":"OAI%3D"}}]}}],"browserMediaSession":{"browserMediaSessionRenderer":{"album":{"runs":[{"text":"Truth."}]},"thumbnailDetails":{"thumbnails":[{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w60-h60-l90-rj","width":60,"height":60},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w120-h120-l90-rj","width":120,"height":120},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w226-h226-l90-rj","width":226,"height":226},{"url":"https://lh3.googleusercontent.com/s2CG1m4KiP2ViOPz0tinz9GeSknmdpbHm6hsye0wKjIpQL9W68PtKTzHBF7Y5JZE5oQmZPcFZ8Jf25hO=w544-h544-l90-rj","width":544,"height":544}]}}}}},"videoReporting":{"reportFormModalRenderer":{"optionsSupportedRenderers":{"optionsRenderer":{"items":[{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Sexual content"}]},"trackingParams":"CA4Q7ZMBGAAiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CA4Q7ZMBGAAiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQASyYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Violent or repulsive content"}]},"trackingParams":"CA0Q7ZMBGAEiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CA0Q7ZMBGAEiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQATaYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Hateful or abusive content"}]},"trackingParams":"CAwQ7ZMBGAIiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAwQ7ZMBGAIiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQARSYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Harassment or bullying"}]},"trackingParams":"CAsQ7ZMBGAMiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAsQ7ZMBGAMiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQARGYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Harmful or dangerous acts"}]},"trackingParams":"CAoQ7ZMBGAQiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAoQ7ZMBGAQiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQAQ2YAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Misinformation"}]},"trackingParams":"CAkQ7ZMBGAUiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAkQ7ZMBGAUiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQAUGYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Child abuse"}]},"trackingParams":"CAgQ7ZMBGAYiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAgQ7ZMBGAYiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQAQyYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Legal issue"}]},"trackingParams":"CAcQ7ZMBGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAcQ7ZMBGAciEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQAUWYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Promotes terrorism"}]},"trackingParams":"CAYQ7ZMBGAgiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAYQ7ZMBGAgiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQATWYAQGoAQM%3D"}}}},{"optionSelectableItemRenderer":{"text":{"runs":[{"text":"Spam or misleading"}]},"trackingParams":"CAUQ7ZMBGAkiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","submitEndpoint":{"clickTrackingParams":"CAUQ7ZMBGAkiEwiL6uGG_oOPAxW9dJ0JHaALCP0=","flagEndpoint":{"flagAction":"EAciDwoLTHlTczQwbk1TbjRQBTILTHlTczQwbk1TbjSQATGYAQGoAQM%3D"}}}}],"trackingParams":"CAQQ9EoiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},"trackingParams":"CAEQ55sBIhMIi-rhhv6DjwMVvXSdCR2gCwj9","title":{"runs":[{"text":"Report video"}]},"submitButton":{"buttonRenderer":{"style":"STYLE_BRAND","isDisabled":true,"text":{"runs":[{"text":"Report"}]},"trackingParams":"CAMQ8FsiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},"cancelButton":{"buttonRenderer":{"style":"STYLE_TEXT","isDisabled":false,"text":{"runs":[{"text":"Cancel"}]},"trackingParams":"CAIQ8FsiEwiL6uGG_oOPAxW9dJ0JHaALCP0="}},"footer":{"runs":[{"text":"If you are the copyright owner of this video and believe it has been uploaded without your permission, please follow "},{"text":"these directions","navigationEndpoint":{"clickTrackingParams":"CAEQ55sBIhMIi-rhhv6DjwMVvXSdCR2gCwj9","urlEndpoint":{"url":"//support.google.com/youtube/answer/2807622?hl=en"}}},{"text":" to submit a copyright infringement notice."}]}}},"queueContextParams":"CAEaEVJEQU1WTUx5U3M0MG5NU240IPqi4ob-g48DKiNRUHlCR0NzcGtaV2gwSVpQU2NaeFBmQ1NJQ2MzZFI2XzMyMTILTHlTczQwbk1TbjRKC0x5U3M0MG5NU240UABaBAgAEAF4AQ=="}

        var responseText = await response.Content.ReadAsStringAsync();
        var jsonDocument = JsonDocument.Parse(responseText);

        return jsonDocument;
    }

    private async Task<string> GetAlbumIdAsync(string browseId)
    {
        var response = await httpClient.GetAsync($"https://music.youtube.com/browse/{browseId}");

        if (!response.IsSuccessStatusCode)
        {
            var responseBody = await response.Content.ReadAsStringAsync();
            throw new InvalidOperationException("Failed to get playlist id.\r\n" + responseBody);
        }

        var responseText = await response.Content.ReadAsStringAsync();

        var albumIdMatch = Regex.Match(responseText, @$"\\x22playlistId\\x22:\\x22(OLAK5uy_{Constants.YouTubeIdRegex})\\x22");

        if (!albumIdMatch.Success)
        {
            throw new InvalidOperationException("Unable to find album id for track.");
        }

        return albumIdMatch.Groups[1].Value;
    }
}
